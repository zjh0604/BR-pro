# å•†å•æŽ¨èç³»ç»Ÿéƒ¨ç½²æŒ‡å— v1.0.10

## ðŸ†• v1.0.10 ç‰ˆæœ¬æ›´æ–°å†…å®¹

### âœ… ä¸»è¦ä¿®å¤å’Œä¼˜åŒ–
1. **åŽç«¯å•†å•ç¼–ç API** - æ–°å¢žé€šè¿‡backend_order_codeçš„CRUDæŽ¥å£
2. **æ•°æ®æ¸…é™¤åŠŸèƒ½** - æ–°å¢žclear_server_data.shè„šæœ¬ï¼Œæ”¯æŒæœåŠ¡å™¨æ•°æ®æ¸…é™¤
3. **æ¨¡åž‹åŠ è½½ä¼˜åŒ–** - ä¼˜åŒ–æ¨¡åž‹åŠ è½½é€»è¾‘ï¼Œæ”¯æŒåœ¨çº¿æ¨¡åž‹å›žé€€
4. **å®¹å™¨å¯åŠ¨ä¼˜åŒ–** - å¼‚æ­¥æ¨¡åž‹æ£€æŸ¥ï¼Œé¿å…å¯åŠ¨é˜»å¡ž
5. **APIæ–‡æ¡£æ›´æ–°** - æ›´æ–°API_Integration_Guide.mdï¼Œæ–°å¢žæŽ¥å£è¯´æ˜Ž
6. **éƒ¨ç½²æŒ‡å—æ›´æ–°** - æ–°å¢žæ•°æ®æ¸…é™¤æ“ä½œè¯´æ˜Ž

## ðŸ†• v1.0.9 ç‰ˆæœ¬æ›´æ–°å†…å®¹

### âœ… ä¸»è¦ä¿®å¤å’Œä¼˜åŒ–
1. **æ•°æ®åº“åˆ›å»ºä¿®å¤** - ä¿®å¤SQLAlchemy URLæ ¼å¼ï¼Œç¡®ä¿test.dbæ–‡ä»¶æ­£ç¡®åˆ›å»º
2. **çŽ¯å¢ƒæ£€æµ‹ä¼˜åŒ–** - ä¿®å¤WindowsçŽ¯å¢ƒè¯¯åˆ¤ä¸ºå®¹å™¨çŽ¯å¢ƒçš„é—®é¢˜
3. **æ¨¡åž‹å¯¼å…¥ä¿®å¤** - ç¡®ä¿æ‰€æœ‰æ¨¡åž‹æ­£ç¡®å¯¼å…¥ï¼Œè§£å†³è¡¨ç»“æž„ä¸åˆ›å»ºé—®é¢˜
4. **SQLAlchemy 2.0å…¼å®¹æ€§** - ä½¿ç”¨text()å‡½æ•°åŒ…è£…SQLæŸ¥è¯¢
5. **ç§»é™¤æ‰‹åŠ¨åˆ›å»º** - ç®€åŒ–ä»£ç ï¼Œç§»é™¤sqlite3ä¾èµ–ï¼Œæé«˜å¯é æ€§
6. **é•œåƒå¤§å°ä¼˜åŒ–** - ç§»é™¤ä¸å¿…è¦çš„sqlite3åŒ…ï¼Œå‡å°‘é•œåƒä½“ç§¯

### âœ… v1.0.7 ç‰ˆæœ¬æ›´æ–°å†…å®¹

### âœ… ä¸»è¦ä¿®å¤å’Œä¼˜åŒ–
1. **æ•°æ®åº“è·¯å¾„ä¿®å¤** - ä¿®å¤æ•°æ®åº“æ–‡ä»¶è·¯å¾„é…ç½®é—®é¢˜
2. **æƒé™é—®é¢˜ä¿®å¤** - è§£å†³å®¹å™¨å†…ç”¨æˆ·æƒé™ä¸Žå®¿ä¸»æœºä¸åŒ¹é…é—®é¢˜
3. **ç¼–ç é—®é¢˜ä¿®å¤** - ä¿®å¤entrypoint.shä¸­çš„å­—ç¬¦ç¼–ç é—®é¢˜
4. **åˆå§‹åŒ–è„šæœ¬ä¼˜åŒ–** - ä½¿ç”¨python3ç¡®ä¿æ­£ç¡®çš„Pythonç‰ˆæœ¬
5. **éªŒè¯è„šæœ¬æ–°å¢ž** - æ–°å¢žverify_deployment.shè‡ªåŠ¨åŒ–éªŒè¯è„šæœ¬
6. **éƒ¨ç½²æµç¨‹ä¼˜åŒ–** - å®Œå–„éƒ¨ç½²éªŒè¯å’Œé—®é¢˜æŽ’æŸ¥æµç¨‹

### âœ… ä¸»è¦ä¿®å¤å’Œä¼˜åŒ–
1. **å®¹å™¨å¯åŠ¨ä¼˜åŒ–** - æ–°å¢ž `entrypoint.sh` è„šæœ¬ï¼Œä¼˜åŒ–å®¹å™¨å¯åŠ¨æµç¨‹
2. **æ•°æ®æŒä¹…åŒ–ä¼˜åŒ–** - ä¼˜åŒ–æ•°æ®ç›®å½•ç»“æž„ï¼Œæ›´å¥½çš„æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆ
3. **Celery ä»»åŠ¡åˆ†ç¦»** - å°† LLM åˆ†æžå’Œç›‘æŽ§ä»»åŠ¡åˆ†ç¦»åˆ°ä¸åŒçš„ worker
4. **å¥åº·æ£€æŸ¥ä¼˜åŒ–** - å®Œå–„æ‰€æœ‰æœåŠ¡çš„å¥åº·æ£€æŸ¥æœºåˆ¶
5. **æ•°æ®åˆå§‹åŒ–ä¼˜åŒ–** - ä¼˜åŒ–æ•°æ®åº“åˆå§‹åŒ–æµç¨‹ï¼Œé¿å…é‡å¤åˆå§‹åŒ–
6. **ç½‘ç»œä¼˜åŒ–** - ç»§ç»­ä¼˜åŒ–ä¸­å›½ç½‘ç»œçŽ¯å¢ƒä¸‹çš„æ€§èƒ½

---

## ðŸ“‹ ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚
- **CPU**: æœ€ä½Ž4æ ¸ï¼ŒæŽ¨è8æ ¸ä»¥ä¸Š
- **å†…å­˜**: æœ€ä½Ž8GBï¼ŒæŽ¨è16GBä»¥ä¸Š
- **å­˜å‚¨**: æœ€ä½Ž20GBå¯ç”¨ç©ºé—´ï¼ˆåŒ…å«æ¨¡åž‹ä¸‹è½½ç¼“å­˜ï¼‰
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿žæŽ¥ï¼ˆç”¨äºŽåƒå¸†APIè°ƒç”¨å’Œæ¨¡åž‹ä¸‹è½½ï¼‰

### è½¯ä»¶è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04+ / CentOS 8+ / Debian 11+
- **Docker**: 20.10+ ï¼ˆå¿…é¡»ï¼‰
- **Docker Compose**: 1.29+ ï¼ˆå¿…é¡»ï¼‰

### ç½‘ç»œç«¯å£
ä»¥ä¸‹ç«¯å£éœ€è¦åœ¨é˜²ç«å¢™ä¸­å¼€æ”¾ï¼š
- **8000**: FastAPIæœåŠ¡
- **5555**: Flowerç›‘æŽ§ç•Œé¢
- **7474**: Neo4j HTTPï¼ˆç®¡ç†ç•Œé¢ï¼‰
- **7687**: Neo4j Boltåè®®
- **6379**: Redisï¼ˆä»…å†…éƒ¨è®¿é—®ï¼‰

## ðŸš€ éƒ¨ç½²æ­¥éª¤

### 1. å‡†å¤‡å·¥ä½œç›®å½•å’Œæ•°æ®
```bash
# åˆ›å»ºå·¥ä½œç›®å½•
mkdir -p /opt/business-rec
cd /opt/business-rec

# åˆ›å»ºå¿…è¦çš„æ•°æ®ç›®å½•
mkdir -p data storage business_vector_db logs cache
```

### 2. å‡†å¤‡æ•°æ®æ–‡ä»¶
å°†åˆå¹¶åŽçš„è®¢å•æ•°æ®æ–‡ä»¶å¤åˆ¶åˆ° data ç›®å½•ï¼š
```bash
# å¤åˆ¶åˆå¹¶åŽçš„è®¢å•æ•°æ®æ–‡ä»¶åˆ°æ•°æ®ç›®å½•
cp /path/to/your/consolidated_orders.json /opt/business-rec/data/
```

**æ³¨æ„**ï¼šå¦‚æžœæ‚¨æœ‰åŽŸå§‹çš„ `orders.json` å’Œ `user_orders.json` æ–‡ä»¶ï¼Œå¯ä»¥å…ˆè¿è¡Œåˆå¹¶è„šæœ¬ï¼š
```bash
# åœ¨æœ¬åœ°è¿è¡Œåˆå¹¶è„šæœ¬ï¼ˆå¯é€‰ï¼‰
python consolidate_json_files.py
# ç„¶åŽå°†ç”Ÿæˆçš„ consolidated_orders.json å¤åˆ¶åˆ°æœåŠ¡å™¨
```

### 3. åˆ›å»ºé…ç½®æ–‡ä»¶

#### 3.1 åˆ›å»º docker-compose.prod.yml
```bash
# åˆ›å»º docker-compose.prod.yml æ–‡ä»¶
cat > docker-compose.prod.yml << 'EOF'
version: '3.8'

services:
  # Neo4j å›¾æ•°æ®åº“
  neo4j:
    image: neo4j:4.4.28
    container_name: business-neo4j
    environment:
      - NEO4J_AUTH=neo4j/password
      - NEO4J_dbms_memory_heap_initial_size=512m
      - NEO4J_dbms_memory_heap_max_size=1G
    ports:
      - "7474:7474"
      - "7687:7687"
    volumes:
      - neo4j_data:/data
    networks:
      - business-net
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "cypher-shell", "-u", "neo4j", "-p", "password", "RETURN 1"]
      interval: 30s
      timeout: 10s
      retries: 5

  # Redis ç¼“å­˜æ•°æ®åº“
  redis:
    image: redis:7-alpine
    container_name: business-redis
    ports:
      - "7379:6379"  # å®¿ä¸»æœº7379ç«¯å£æ˜ å°„åˆ°å®¹å™¨6379ï¼Œé¿å…ä¸Žæœ¬åœ°Rediså†²çª
    volumes:
      - redis_data:/data
    networks:
      - business-net
    restart: unless-stopped
    command: redis-server --appendonly yes --maxmemory 512mb --maxmemory-policy allkeys-lru
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 30s
      timeout: 3s
      retries: 5

  # API æœåŠ¡
  api:
    image: registry.cn-hangzhou.aliyuncs.com/sohuglobal/businessrec:v1.0.12
    container_name: business-api-prod
    ports:
      - "8000:8000"
    environment:
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=password
      - QIANFAN_AK=${QIANFAN_AK}
      - QIANFAN_SK=${QIANFAN_SK}
      - SENTENCE_TRANSFORMERS_HOME=/app/models
      - AES_KEY=${AES_KEY}
      - HMAC_KEY=${HMAC_KEY}
    volumes:
      - ./data:/app/data
      - ./storage:/app/storage
      - ./business_vector_db:/app/business_vector_db
      - ./cache:/app/cache
      - ./logs:/app/logs
      - ./text2vec-large-chinese:/app/text2vec-large-chinese
      - model_cache:/app/models
    depends_on:
      neo4j:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - business-net
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/"]
      interval: 30s
      timeout: 10s
      retries: 5

  # Celery Worker - LLMåˆ†æžé˜Ÿåˆ—
  celery-llm-worker:
    image: registry.cn-hangzhou.aliyuncs.com/sohuglobal/businessrec:v1.0.12
    container_name: business-celery-llm-worker-prod
    command: celery -A celery_app worker -l info -c 2 --max-tasks-per-child=50
    environment:
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=password
      - QIANFAN_AK=${QIANFAN_AK}
      - QIANFAN_SK=${QIANFAN_SK}
      - SENTENCE_TRANSFORMERS_HOME=/app/models
      - AES_KEY=${AES_KEY}
      - HMAC_KEY=${HMAC_KEY}
    volumes:
      - ./data:/app/data
      - ./storage:/app/storage
      - ./business_vector_db:/app/business_vector_db
      - ./cache:/app/cache
      - ./logs:/app/logs
      - ./text2vec-large-chinese:/app/text2vec-large-chinese
      - model_cache:/app/models
    depends_on:
      redis:
        condition: service_healthy
      neo4j:
        condition: service_healthy
    networks:
      - business-net
    restart: always

  # Celery Worker - ç›‘æŽ§é˜Ÿåˆ—
  celery-monitor-worker:
    image: registry.cn-hangzhou.aliyuncs.com/sohuglobal/businessrec:v1.0.12
    container_name: business-celery-monitor-worker-prod
    command: celery -A celery_app worker -l info -c 2 --max-tasks-per-child=50
    environment:
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=password
      - QIANFAN_AK=${QIANFAN_AK}
      - QIANFAN_SK=${QIANFAN_SK}
      - SENTENCE_TRANSFORMERS_HOME=/app/models
      - AES_KEY=${AES_KEY}
      - HMAC_KEY=${HMAC_KEY}
    volumes:
      - ./data:/app/data
      - ./storage:/app/storage
      - ./business_vector_db:/app/business_vector_db
      - ./cache:/app/cache
      - ./logs:/app/logs
      - ./text2vec-large-chinese:/app/text2vec-large-chinese
      - model_cache:/app/models
    depends_on:
      redis:
        condition: service_healthy
      neo4j:
        condition: service_healthy
    networks:
      - business-net
    restart: always

  # Flower ç›‘æŽ§å·¥å…·
  flower:
    image: registry.cn-hangzhou.aliyuncs.com/sohuglobal/businessrec:v1.0.12
    container_name: business-flower-prod
    command: celery -A celery_app flower --port=5555
    ports:
      - "5555:5555"
    environment:
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - QIANFAN_AK=${QIANFAN_AK}
      - QIANFAN_SK=${QIANFAN_SK}
      - SENTENCE_TRANSFORMERS_HOME=/app/models
      - AES_KEY=${AES_KEY}
      - HMAC_KEY=${HMAC_KEY}
    volumes:
      - ./data:/app/data
      - ./storage:/app/storage
      - ./business_vector_db:/app/business_vector_db
      - ./cache:/app/cache
      - ./logs:/app/logs
      - ./text2vec-large-chinese:/app/text2vec-large-chinese
      - model_cache:/app/models
    depends_on:
      - redis
    networks:
      - business-net
    restart: always

  # æ•°æ®åˆå§‹åŒ–æœåŠ¡
  init-db:
    image: registry.cn-hangzhou.aliyuncs.com/sohuglobal/businessrec:v1.0.12
    container_name: business-init-db-prod
    entrypoint: ["bash", "-c"]
    command: ["sleep 30 && python3 init_db_from_json.py && python3 init_graph_db.py"]
    environment:
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=password
      - QIANFAN_AK=${QIANFAN_AK}
      - QIANFAN_SK=${QIANFAN_SK}
      - SENTENCE_TRANSFORMERS_HOME=/app/models
      - AES_KEY=${AES_KEY}
      - HMAC_KEY=${HMAC_KEY}
    volumes:
      - ./data:/app/data
      - ./storage:/app/storage
      - ./business_vector_db:/app/business_vector_db
      - ./cache:/app/cache
      - ./logs:/app/logs
      - ./text2vec-large-chinese:/app/text2vec-large-chinese
      - model_cache:/app/models
    depends_on:
      neo4j:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks:
      - business-net
    restart: "no"

volumes:
  neo4j_data:
  redis_data:
  model_cache:

networks:
  business-net:
    driver: bridge
EOF
```

#### 3.2 åˆ›å»ºçŽ¯å¢ƒå˜é‡æ–‡ä»¶
```bash
cat > .env << 'EOF'
# åƒå¸†AIå¹³å°é…ç½®
QIANFAN_AK=your_actual_access_key
QIANFAN_SK=your_actual_secret_key

# AES & HMAC å¯†é’¥ï¼ˆå¿…éœ€ï¼‰
AES_KEY=1234567890123456
HMAC_KEY=your_hmac_secret_key

# æ•°æ®åº“é…ç½®
REDIS_HOST=redis
REDIS_PORT=6379
NEO4J_URI=bolt://neo4j:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=password
EOF
```
```bash
QIANFAN_AK=XSJX4K42BrVpcUMCgHY8FlfF
QIANFAN_SK=JFi304xjqzXZPAE1k1087scqbOQ7MiKv

#AES & HMAC å¯†é’¥
AES_KEY=1234567890123456
HMAC_KEY=your_hmac_secret_key

```

### 4. ç™»å½•é˜¿é‡Œäº‘é•œåƒä»“åº“
```bash
# ç™»å½•é˜¿é‡Œäº‘é•œåƒä»“åº“ï¼ˆå¿…éœ€æ­¥éª¤ï¼‰
# å¦‚æžœæ²¡æœ‰ç™»å½•ï¼Œå°†æ— æ³•æ‹‰å–ç§æœ‰é•œåƒ
docker login registry.cn-hangzhou.aliyuncs.com

# è¾“å…¥ä»¥ä¸‹å‡­æ®ï¼š
# ç”¨æˆ·å: yangbin_tb2008
# å¯†ç : sohuglobal123

# éªŒè¯ç™»å½•çŠ¶æ€
docker login --get-login registry.cn-hangzhou.aliyuncs.com
```


### 5. è®¾ç½®ç›®å½•æƒé™
```bash
# è®¾ç½®ç›®å½•æƒé™ï¼ˆç¡®ä¿å®¹å™¨å†…çš„åº”ç”¨ç”¨æˆ·å¯ä»¥è®¿é—®ï¼‰
# å®¹å™¨å†…appuserçš„UID/GIDä¸º999:999
chown -R 999:999 data storage business_vector_db logs cache
chmod -R 755 data storage business_vector_db logs cache
```

### 6. å¯åŠ¨æœåŠ¡
```bash
# æ‹‰å–å¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml pull
docker-compose -f docker-compose.prod.yml up -d
```

### 7. ç›‘æŽ§åˆå§‹åŒ–è¿›åº¦
```bash
# ç›‘æŽ§åˆå§‹åŒ–æœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f init-db

# ç­‰å¾…çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š
# - "Database initialization complete"
# - "å‘é‡æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ"
```

### 8. éªŒè¯éƒ¨ç½²
éƒ¨ç½²å®ŒæˆåŽï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

1. **APIæœåŠ¡**ï¼š
   ```bash
   curl http://localhost:8000/
   ```

2. **Flowerç›‘æŽ§**ï¼š
   åœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://your-server-ip:5555`

3. **Neo4jç®¡ç†ç•Œé¢**ï¼š
   åœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://your-server-ip:7474`

4. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**ï¼š
   ```bash
   docker-compose -f docker-compose.prod.yml ps
   ```

5. **ä½¿ç”¨éªŒè¯è„šæœ¬**ï¼ˆæŽ¨èï¼‰ï¼š
   ```bash
   # ä¸‹è½½éªŒè¯è„šæœ¬
   curl -O https://raw.githubusercontent.com/your-repo/business-rec/main/verify_deployment.sh
   chmod +x verify_deployment.sh
   
   # æ‰§è¡ŒéªŒè¯
   ./verify_deployment.sh
   ```

5. **æŸ¥çœ‹æœåŠ¡æ—¥å¿—**ï¼š
   ```bash
   # æŸ¥çœ‹åˆå§‹åŒ–æœåŠ¡æ—¥å¿—
   docker-compose -f docker-compose.prod.yml logs init-db
   
   # æŸ¥çœ‹APIæœåŠ¡æ—¥å¿—
   docker-compose -f docker-compose.prod.yml logs api
   
   # æŸ¥çœ‹LLM Workeræ—¥å¿—
   docker-compose -f docker-compose.prod.yml logs celery-llm-worker
   
   # æŸ¥çœ‹ç›‘æŽ§Workeræ—¥å¿—
   docker-compose -f docker-compose.prod.yml logs celery-monitor-worker
   ```

## ðŸ“Š æœåŠ¡è®¿é—®åœ°å€

éƒ¨ç½²æˆåŠŸåŽï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®æœåŠ¡ï¼š

- **APIæœåŠ¡**: http://your-server-ip:8000
- **Flowerç›‘æŽ§**: http://your-server-ip:5555
- **Neo4jç®¡ç†ç•Œé¢**: http://your-server-ip:7474

## ðŸ“ ç›®å½•ç»“æž„è¯´æ˜Ž

```
/opt/business-rec/
â”œâ”€â”€ data/                # åˆå§‹åŒ–æ•°æ®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ orders.json
â”‚   â””â”€â”€ user_orders.json
â”œâ”€â”€ storage/            # æ•°æ®åº“æ–‡ä»¶å­˜å‚¨ç›®å½•
â”‚   â”œâ”€â”€ test.db        # SQLiteæ•°æ®åº“æ–‡ä»¶
â”‚   â””â”€â”€ business_graph.db/  # Neo4jæ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ business_vector_db/ # å‘é‡æ•°æ®åº“æ–‡ä»¶ç›®å½•
â”œâ”€â”€ logs/              # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ cache/             # ç¼“å­˜æ–‡ä»¶ç›®å½•
â”œâ”€â”€ .env               # çŽ¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶
â””â”€â”€ docker-compose.prod.yml  # Dockerç¼–æŽ’é…ç½®æ–‡ä»¶
```

## ðŸ”§ å¸¸è§é—®é¢˜å¤„ç†

### 1. æœåŠ¡æ— æ³•å¯åŠ¨
- æ£€æŸ¥ç›®å½•æƒé™æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æ•°æ®æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
- æ£€æŸ¥çŽ¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æ­£ç¡®
- æŸ¥çœ‹æœåŠ¡æ—¥å¿—ä»¥èŽ·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### 2. æ•°æ®åˆå§‹åŒ–å¤±è´¥
- ç¡®ä¿ data ç›®å½•ä¸­åŒ…å«å¿…è¦çš„æ•°æ®æ–‡ä»¶ï¼ˆorders.json, user_orders.jsonï¼‰
- æ£€æŸ¥æ•°æ®æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹ init-db æœåŠ¡çš„æ—¥å¿—ï¼š`docker-compose -f docker-compose.prod.yml logs init-db`

### 3. å†…å­˜ä½¿ç”¨è¿‡é«˜
- è°ƒæ•´ Neo4j çš„å†…å­˜é…ç½®ï¼ˆNEO4J_dbms_memory_heap_max_sizeï¼‰
- è°ƒæ•´ Redis çš„æœ€å¤§å†…å­˜é™åˆ¶ï¼ˆmaxmemoryï¼‰
- è€ƒè™‘å¢žåŠ æœåŠ¡å™¨å†…å­˜

### 4. æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
docker exec -it business-api-prod ls -la /app/storage/test.db

# æ‰‹åŠ¨æ‰§è¡Œåˆå§‹åŒ–
docker exec -it business-init-db-prod bash
python3 init_db_from_json.py
exit
```

### 5. æƒé™é—®é¢˜
```bash
# ä¿®å¤ç›®å½•æƒé™
sudo chown -R 999:999 /opt/business-rec/storage/
sudo chmod -R 755 /opt/business-rec/storage/

# é‡å¯æœåŠ¡
docker-compose -f docker-compose.prod.yml restart api
```

### 6. æœåŠ¡ä¸å¥åº·
```bash
# æ£€æŸ¥æœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs api

# æ£€æŸ¥æ•°æ®åº“è¿žæŽ¥
docker exec -it business-api-prod python3 -c "
from storage.db import engine
print('æ•°æ®åº“è¿žæŽ¥æµ‹è¯•:', engine)
"
```

## ðŸ“‹ æ€»ä½“æ­¥éª¤é¡ºåº

1. **å‡†å¤‡å·¥ä½œç›®å½•å’Œæ•°æ®**
2. **å‡†å¤‡æ•°æ®æ–‡ä»¶**ï¼ˆorders.json, user_orders.jsonï¼‰
3. **åˆ›å»ºé…ç½®æ–‡ä»¶**ï¼ˆdocker-compose.prod.yml å’Œ .envï¼‰
4. **ç™»å½•é˜¿é‡Œäº‘é•œåƒä»“åº“**
5. **è®¾ç½®ç›®å½•æƒé™**
6. **å¯åŠ¨æœåŠ¡**
7. **ç›‘æŽ§åˆå§‹åŒ–è¿›åº¦**
8. **éªŒè¯éƒ¨ç½²**

## ðŸš¨ é‡è¦æé†’

- **æ•°æ®æ–‡ä»¶å¿…éœ€**ï¼šç¡®ä¿ `data/orders.json` å’Œ `data/user_orders.json` æ–‡ä»¶å­˜åœ¨
- **æƒé™è®¾ç½®**ï¼šå®¹å™¨å†…ç”¨æˆ·UID/GIDä¸º999:999ï¼Œå¿…é¡»æ­£ç¡®è®¾ç½®ç›®å½•æƒé™
- **åˆå§‹åŒ–ç­‰å¾…**ï¼šç³»ç»Ÿå¯åŠ¨åŽéœ€è¦ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼ˆçº¦5-15åˆ†é’Ÿï¼‰
- **éªŒè¯è„šæœ¬**ï¼šå»ºè®®ä½¿ç”¨ `verify_deployment.sh` è¿›è¡Œè‡ªåŠ¨åŒ–éªŒè¯

## ðŸ§¹ æ•°æ®æ¸…é™¤æ“ä½œ

### æ¸…é™¤æ‰€æœ‰æµ‹è¯•æ•°æ®

å½“éœ€è¦æ¸…é™¤æœåŠ¡å™¨ä¸Šçš„æµ‹è¯•æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

#### æ–¹æ³•1ï¼šä½¿ç”¨æ¸…é™¤è„šæœ¬ï¼ˆæŽ¨èï¼‰
```bash
# 1. ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x clear_server_data.sh

# 2. æ‰§è¡Œæ¸…é™¤æ“ä½œ
./clear_server_data.sh
```

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨æ¸…é™¤
```bash
# 1. åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml down

# 2. æ¸…é™¤æ•°æ®å·
docker-compose -f docker-compose.prod.yml down -v

# 3. åˆ é™¤æœ¬åœ°æ•°æ®æ–‡ä»¶
rm -f ./storage/test.db
rm -rf ./business_vector_db/*
rm -rf ./cache/*
find ./logs -name "*.log" -delete

# 4. é‡æ–°å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# 5. ç­‰å¾…åˆå§‹åŒ–å®Œæˆ
docker-compose -f docker-compose.prod.yml logs -f init-db
```

#### æ–¹æ³•3ï¼šä½¿ç”¨Pythonè„šæœ¬
```bash
# åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
python reset_database.py
```

### æ¸…é™¤èŒƒå›´è¯´æ˜Ž

**ä¼šè¢«æ¸…é™¤çš„æ•°æ®**ï¼š
- SQLiteæ•°æ®åº“ä¸­çš„æ‰€æœ‰å•†å•ã€ç”¨æˆ·ã€æ—¥å¿—
- å‘é‡æ•°æ®åº“ä¸­çš„æ‰€æœ‰å‘é‡æ•°æ®
- Redisç¼“å­˜ä¸­çš„æ‰€æœ‰æŽ¨èç¼“å­˜
- Neo4jå›¾æ•°æ®åº“ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å’Œå…³ç³»
- åº”ç”¨æ—¥å¿—æ–‡ä»¶

**ä¼šè¢«ä¿ç•™çš„æ•°æ®**ï¼š
- æ•°æ®åº“è¡¨ç»“æž„
- ç³»ç»Ÿé…ç½®æ–‡ä»¶
- æ¨¡åž‹æ–‡ä»¶ï¼ˆå¦‚æžœæŒ‚è½½äº†çš„è¯ï¼‰



